#cloud-config
users:
  - name: debian
    primary_group: sudo
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCknK37QKXdA4PYpZMIuHMraGjqDOXaNtMmIZI4FBhd2Z0GmtVvIpYwwNm3lR/eEZ4/6mV1OcOgt/eV7wccCBXEFxQNA2j7amh5JBH11SpLxFRw2YOiRpPK9/w1ontGgI0MXrhuxxnkIhx7V8NvpcqX3FVP2wHhq5REXa6USuT8thgEuhC+aP26a5Upx7qR2k+WsOEmfW/XoMXEqac156eBP79EuR6xxBitKNfgQqI1VFq1uutg26zWdwbUBjTqg0mZ308suCbMfMDnJ0wzVuJrm7kzoEJWWcwUNBVXa/Kwc9yHPxGIszjZeLl16klxp5KBjmJsN4fTny++EDeYylDL ahinh43@github/33781835
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2PhL297eW7+AEBekvgcXu0ikumqbu2eIr+TfOj++92hTNo7rFTX4hYjr9n31+j1vTkHYQxqg7XMFEdF3HNFB1Bg9dLJBOVgDHC/WDF94HbN4DuKwfmZN8YZ6Ev8XRidBZvfbfxbHk9gVbEFhl6vB3NlTLG8X6XPF+zycXOffQGNyf731Fh89eLl0yobusTD72F+4T0BUhgRrCrvy08EWaAovDuOcyHh2jfITK+jlPzn6QibSxFCy1JDztAtzZS5YcBhOhayxkWoQb4kw033wciI2KSP841ZCQM1uEFm1/9i2VgRGA4ry8gNdFwr7l6Z09NG6Q7wbg6DXhcjYPGWeJlkLkGa6txeM9dH9IbhlfIPAnNHxGCG+iwvavNjgPAv0q23qIb3K13zPhd8nzYWf1X/BIUtrGrn7LIxgxkw6B3kHn5mzaEBaZk2k3jAAGZkwM7/7ThQAEJ94lVyHyNzoS6kJqk6bW3pGxxpXTnQGhNWeCrFj+RmG93gKbW6a5Yr0= ahinh43@github/84668115
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBFZ6pd5qmAhRH0pJlSO5Bq0+r1D/PzsXyX4jNg12KRQ
  - name: steam
    shell: /bin/bash
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCknK37QKXdA4PYpZMIuHMraGjqDOXaNtMmIZI4FBhd2Z0GmtVvIpYwwNm3lR/eEZ4/6mV1OcOgt/eV7wccCBXEFxQNA2j7amh5JBH11SpLxFRw2YOiRpPK9/w1ontGgI0MXrhuxxnkIhx7V8NvpcqX3FVP2wHhq5REXa6USuT8thgEuhC+aP26a5Upx7qR2k+WsOEmfW/XoMXEqac156eBP79EuR6xxBitKNfgQqI1VFq1uutg26zWdwbUBjTqg0mZ308suCbMfMDnJ0wzVuJrm7kzoEJWWcwUNBVXa/Kwc9yHPxGIszjZeLl16klxp5KBjmJsN4fTny++EDeYylDL ahinh43@github/33781835
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2PhL297eW7+AEBekvgcXu0ikumqbu2eIr+TfOj++92hTNo7rFTX4hYjr9n31+j1vTkHYQxqg7XMFEdF3HNFB1Bg9dLJBOVgDHC/WDF94HbN4DuKwfmZN8YZ6Ev8XRidBZvfbfxbHk9gVbEFhl6vB3NlTLG8X6XPF+zycXOffQGNyf731Fh89eLl0yobusTD72F+4T0BUhgRrCrvy08EWaAovDuOcyHh2jfITK+jlPzn6QibSxFCy1JDztAtzZS5YcBhOhayxkWoQb4kw033wciI2KSP841ZCQM1uEFm1/9i2VgRGA4ry8gNdFwr7l6Z09NG6Q7wbg6DXhcjYPGWeJlkLkGa6txeM9dH9IbhlfIPAnNHxGCG+iwvavNjgPAv0q23qIb3K13zPhd8nzYWf1X/BIUtrGrn7LIxgxkw6B3kHn5mzaEBaZk2k3jAAGZkwM7/7ThQAEJ94lVyHyNzoS6kJqk6bW3pGxxpXTnQGhNWeCrFj+RmG93gKbW6a5Yr0= ahinh43@github/84668115
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBFZ6pd5qmAhRH0pJlSO5Bq0+r1D/PzsXyX4jNg12KRQ
apt:
  sources_list: |
    deb $MIRROR $RELEASE main contrib non-free non-free-firmware
    deb-src $MIRROR $RELEASE main contrib non-free non-free-firmware
    deb $SECURITY $RELEASE-securityE main contrib non-free non-free-firmware
    deb-src $SECURITY $RELEASE-security main contrib non-free non-free-firmware
hostname: palworld-1.kubevirt-vms.svc.cluster.local
ssh_pwauth: False
disable_root: false
package_update: true
package_upgrade: true
packages:
  - dnsutils
  - htop
  - jq
  - tmux
  - unattended-upgrades
  - awscli
  - cron
  - prometheus-node-exporter

# This happens before the user creation
# so the files are owned by root first to prevent username not found errors
write_files:
  - path: /root/install-palworld.sh
    owner: root:root
    permissions: "0755"
    encoding: b64
    content: IyEvdXNyL2Jpbi9lbnYgYmFzaAoKIyBJbnN0YWxscyBTdGVhbWNtZCwgcGFsd29ybGQgc2VydmVyIG9uIHRoZSBzdGVhbSB1c2VyLCBhbmQgc2V0cyB1cCB0aGUgc2VydmVyIFN5c3RlbWQgc2VydmljZSBmaWxlCiMgSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGUgbm9uLWZyZWUgcmVwbyBpcyBlbmFibGVkIG9uIERlYmlhbiB2aWEgQ2xvdWQgaW5pdAojIE11c3QgYmUgcmFuIGFzIHJvb3QKCiMgSW5zdGFsbCBzdGVhbWNtZAphcHQtZ2V0IGluc3RhbGwgLXkgc3RlYW1jbWQKCgojIFRha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2NkcDEzMzcvQVJLU3Vydml2YWxBc2NlbmRlZC1MaW51eC9ibG9iL21haW4vc2VydmVyLWluc3RhbGwtZGViaWFuMTIuc2gKIyBEZXRlcm1pbmUgd2hlcmUgU3RlYW0gaXMgaW5zdGFsbGVkCiMgc29tZXRpbWVzIGl0J3MgaW4gfi9TdGVhbSwgd2hlcmVhcyBvdGhlciB0aW1lcyBpdCdzIGluIH4vLmxvY2FsL3NoYXJlL1N0ZWFtCiMgQHRvZG8gZmlndXJlIG91dCB3aHkuLi4uIHRoaXMgaXMgYW5ub3lpbmcuCmlmIFsgLWUgIi9ob21lL3N0ZWFtL1N0ZWFtIiBdOyB0aGVuCiAgU1RFQU1ESVI9Ii9ob21lL3N0ZWFtL1N0ZWFtIgplbGlmIFsgLWUgIi9ob21lL3N0ZWFtLy5sb2NhbC9zaGFyZS9TdGVhbSIgXTsgdGhlbgogIFNURUFNRElSPSIvaG9tZS9zdGVhbS8ubG9jYWwvc2hhcmUvU3RlYW0iCmVsc2UKICBlY2hvICJVbmFibGUgdG8gZ3Vlc3Mgd2hlcmUgU3RlYW0gaXMgaW5zdGFsbGVkLiIgPiYyCiAgZXhpdCAxCmZpCgojIEluc3RhbGwgcGFsd29ybGQgc2VydmVyCnN1ZG8gLXUgc3RlYW0gL3Vzci9nYW1lcy9zdGVhbWNtZCArbG9naW4gYW5vbnltb3VzICthcHBfdXBkYXRlIDIzOTQwMTAgdmFsaWRhdGUgK3F1aXQKCiMgQ3JlYXRlIHN5bWxpbmtzIGZvciBlYXN5IGFjY2VzcyB0byB0aGUgc2VydmVyIGZpbGVzCgpsbiAtcyAke1NURUFNRElSfS9zdGVhbWFwcHMvY29tbW9uL1BhbFNlcnZlci9QYWwvU2F2ZWQvQ29uZmlnL0xpbnV4U2VydmVyIC9ob21lL3N0ZWFtL2NvbmZpZ3MKbG4gLXMgJHtTVEVBTURJUn0vc3RlYW1hcHBzL2NvbW1vbi9QYWxTZXJ2ZXIgL2hvbWUvc3RlYW0vcGFsd29ybGQKCgpjYXQgPiAvZXRjL3N5c3RlbWQvc3lzdGVtL3BhbHdvcmxkLnNlcnZpY2UgPDxFT0YKW1VuaXRdCkRlc2NyaXB0aW9uPVBhbHdvcmxkCkFmdGVyPW5ldHdvcmsudGFyZ2V0CgpbU2VydmljZV0KVHlwZT1zaW1wbGUKTGltaXROT0ZJTEU9MTAwMDAKVXNlcj1zdGVhbQpHcm91cD1zdGVhbQpFeGVjU3RhcnRQcmU9L3Vzci9nYW1lcy9zdGVhbWNtZCArbG9naW4gYW5vbnltb3VzICthcHBfdXBkYXRlIDIzOTQwMTAgdmFsaWRhdGUgK3F1aXQKV29ya2luZ0RpcmVjdG9yeT0ke1NURUFNRElSfS9zdGVhbWFwcHMvY29tbW9uL1BhbFNlcnZlcgpFeGVjU3RhcnQ9L3Vzci9iaW4vZW52IGJhc2ggLi9QYWxTZXJ2ZXIuc2ggLXVzZXBlcmZ0aHJlYWRzIC1Ob0FzeW5jTG9hZGluZ1RocmVhZCAtVXNlTXVsdGl0aHJlYWRGb3JEUyAtbG9nIApSZXN0YXJ0PW9uLWZhaWx1cmUKUmVzdGFydFNlYz0yMHMKCltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldApFT0YKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCnN5c3RlbWN0bCBlbmFibGUgcGFsd29ybGQuc2VydmljZQpzeXN0ZW1jdGwgc3RhcnQgcGFsd29ybGQuc2VydmljZQ==
  - path: /root/backupPal.sh
    owner: root:root
    permissions: "0755"
    encoding: b64
    content: IyEvdXNyL2Jpbi9lbnYgYmFzaAoKZGlybmFtZT0kKGRhdGUgKyVZLSVtLSVkLSVILSVNLSVTLXBhbGJhY2t1cCkKYmFzZXBhdGg9Ii9ob21lL3N0ZWFtL3BhbHdvcmxkL1BhbC9TYXZlZCIKCiMgQmFja3VwIHNlcnZlciBjb25maWcKYXdzIC0tZW5kcG9pbnQtdXJsIGh0dHA6Ly9taW5pby5sYWJzLmFoaW5oLm1lOjkwMDAgczMgY3AgLS1yZWN1cnNpdmUgIiR7YmFzZXBhdGh9L0NvbmZpZyIgczM6Ly9wYWx3b3JsZC8kZGlybmFtZS9Db25maWcgLS1leGNsdWRlICcuZ2l0LyonIC0tZXhjbHVkZSAnQ3Jhc2hSZXBvcnRDbGllbnQvKicKIyBCYWNrdXAgdGhlIHdvcmxkIGFuZCBwbGF5ZXJzCmF3cyAtLWVuZHBvaW50LXVybCBodHRwOi8vbWluaW8ubGFicy5haGluaC5tZTo5MDAwIHMzIGNwIC0tcmVjdXJzaXZlICIke2Jhc2VwYXRofS9TYXZlR2FtZXMvMC85NUEyQjJEMEFCRTM0RDc5QjlFMDJDNzgwNTQ2RTAxMiIgczM6Ly9wYWx3b3JsZC8kZGlybmFtZS9TYXZlR2FtZXMvMC85NUEyQjJEMEFCRTM0RDc5QjlFMDJDNzgwNTQ2RTAxMg==
  - path: /root/palworldcron
    owner: root:root
    permissions: "0755"
    encoding: b64
    content: MCAxMiAqICogKiAvaG9tZS9zdGVhbS9iYWNrdXBQYWwuc2gKMCAwICogKiAqIC9ob21lL3N0ZWFtL2JhY2t1cFBhbC5zaAozMCAxMyAqICogKiBzdWRvIHN5c3RlbWN0bCByZXN0YXJ0IHBhbHdvcmxkLnNlcnZpY2UK

runcmd:
  - cp /root/install-palworld.sh /home/steam/install-palworld.sh && chown steam:steam /home/steam/install-palworld.sh
  - cp /root/backupPal.sh /home/steam/backupPal.sh && chown steam:steam /home/steam/backupPal.sh
  - cp /root/palworldcron /home/steam/palworldcron && chown steam:steam /home/steam/palworldcron
  - sudo -u steam crontab -l | { cat; cat /home/steam/palworldcron; } | crontab -
